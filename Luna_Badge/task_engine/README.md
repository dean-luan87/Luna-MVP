# Luna Badge v1.4 - æœ€å°ä»»åŠ¡å¼•æ“å­ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ“š è®¾è®¡ç›®æ ‡

æ„å»ºä¸€ä¸ª**å¯è½åœ°ã€å¯é›†æˆã€å¯æ§ç¼“å­˜**çš„ä»»åŠ¡å¼•æ“å­ç³»ç»Ÿï¼Œä¸“ä¸ºè§†éšœåœºæ™¯æ‰“é€ ï¼Œå…·å¤‡ï¼š

- âœ… ç®¡ç†ä¸»çº¿ä»»åŠ¡é“¾ + æ’å…¥ä»»åŠ¡
- âœ… æ§åˆ¶ä»»åŠ¡çŠ¶æ€åˆ‡æ¢ï¼ˆè¿è¡Œ/æš‚åœ/å®Œæˆ/ä¸¢å¼ƒï¼‰
- âœ… é™åˆ¶ä»»åŠ¡ç¼“å­˜æ•°é‡ï¼Œé¿å…å†…å­˜å ç”¨ç´¯ç§¯
- âœ… å¯åµŒå…¥è‡³ä¸»æµç¨‹ä¸­é€æ­¥æ¼”åŒ–ä¸ºå®Œæ•´ Task Hub

---

## ğŸ§© ç³»ç»Ÿç»„æˆæ¨¡å—

| æ¨¡å— | è¯´æ˜ |
|------|------|
| `task_engine.py` | å­ç³»ç»Ÿå…¥å£ï¼Œè´Ÿè´£æ³¨å†Œ/æ‰§è¡Œ/é‡Šæ”¾ä»»åŠ¡é“¾ |
| `task_graph.json` | æ¯ä¸ªä»»åŠ¡é“¾çš„æ•°æ®ç»“æ„ |
| `task_node_executor.py` | èŠ‚ç‚¹æ‰§è¡Œå™¨ï¼Œè°ƒç”¨å®é™…æ¨¡å—æ‰§è¡Œï¼ˆå¦‚å¯¼èˆª/æ’­æŠ¥ï¼‰ |
| `task_state_manager.py` | å½“å‰çŠ¶æ€è®°å½•å™¨ï¼ˆè¿›åº¦ã€æ’å…¥ä»»åŠ¡ã€æ˜¯å¦ä¸­æ–­ï¼‰ |
| `task_cache_manager.py` | ä»…ä¿ç•™ 3ä¸ªä»»åŠ¡ç¼“å­˜ï¼ˆæœ€æ–°ä¸»ä»»åŠ¡ + 2ä¸ªå­ä»»åŠ¡ï¼‰ |
| `task_cleanup.py` | è¶…æ—¶/å·²å®Œæˆä»»åŠ¡è‡ªåŠ¨é‡Šæ”¾ |
| `inserted_task_queue.py` | æ’å…¥ä»»åŠ¡æ’é˜Ÿæœºåˆ¶ï¼Œæ”¯æŒè¿”å›ä¸»ä»»åŠ¡ç‚¹ |

---

## âš™ï¸ è¿è¡Œæœºåˆ¶

```
ç”¨æˆ·å‘½ä»¤ â†’ è§¦å‘ä»»åŠ¡é“¾ â†’ task_engine â†’ task_graph_parser
                                    â†“
                        task_node_executor â†’ è°ƒç”¨åŠŸèƒ½æ¨¡å—
                                    â†“
                           èŠ‚ç‚¹å®Œæˆ â†’ task_state_manager

æ’å…¥è¯­éŸ³ â†’ inserted_task_queue â†’ task_engine
                                   â†“
                           inserted_graph â†’ task_node_executor

å®Œæˆå…¨éƒ¨ä»»åŠ¡ â†’ task_cleanup â†’ task_cache_manager
```

---

## ğŸ”§ å¤šä»»åŠ¡è”åŠ¨é€»è¾‘ï¼ˆv1.4 é™åˆ¶ï¼‰

| ç±»å‹ | é™åˆ¶æ¡ä»¶ |
|------|----------|
| **ä¸»ä»»åŠ¡é“¾** | ä»…æ”¯æŒ 1 ä¸ª active |
| **æ’å…¥ä»»åŠ¡é“¾** | åŒæ—¶æœ€å¤šå­˜åœ¨ 2 ä¸ªï¼ˆè¿›è¡Œä¸­ + æš‚åœï¼‰ |
| **æ¢å¤æœºåˆ¶** | æ’å…¥ä»»åŠ¡å®Œæˆåï¼Œå›åˆ°ä¸»ä»»åŠ¡ä¸­æ–­ç‚¹ |
| **æ¸…ç†æœºåˆ¶** | å·²å®Œæˆ / ä¸¢å¼ƒä»»åŠ¡ â†’ å»¶è¿Ÿ 2 åˆ†é’Ÿåè‡ªåŠ¨é‡Šæ”¾ |
| **è¶…æ—¶ä»»åŠ¡** | 60åˆ†é’Ÿæ— è¿›åº¦ â†’ å¼ºåˆ¶å…³é—­ï¼ˆè®°å½•ä¸ºå¼‚å¸¸ï¼‰ |

---

## ğŸ“ æ–‡ä»¶ä¸ç›®å½•ç»“æ„

```
luna_badge/
â”œâ”€â”€ task_engine.py                  # æ€»å…¥å£
â”œâ”€â”€ task_graphs/
â”‚   â””â”€â”€ hospital_visit.json         # åŒ»é™¢ä»»åŠ¡é“¾
â”‚   â””â”€â”€ buy_snack.json              # æ’å…¥ä»»åŠ¡ç¤ºä¾‹
â”œâ”€â”€ task_node_executor.py
â”œâ”€â”€ task_state_manager.py
â”œâ”€â”€ inserted_task_queue.py
â”œâ”€â”€ task_cache_manager.py
â”œâ”€â”€ task_cleanup.py
â””â”€â”€ __init__.py
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. ä»»åŠ¡å¼•æ“ (`task_engine.py`)

**èŒè´£**ï¼šæ€»å…¥å£ï¼Œè´Ÿè´£ä»»åŠ¡é“¾çš„æ³¨å†Œã€æ‰§è¡Œã€é‡Šæ”¾

**ä¸»è¦æ–¹æ³•**ï¼š
```python
- load_task_graph(graph_file): åŠ è½½ä»»åŠ¡å›¾JSONæ–‡ä»¶
- register_task(task_graph): æ³¨å†Œä»»åŠ¡é“¾
- start_task(graph_id): å¯åŠ¨ä»»åŠ¡
- pause_task(graph_id): æš‚åœä»»åŠ¡
- resume_task(graph_id): æ¢å¤ä»»åŠ¡
- complete_task(graph_id): å®Œæˆä»»åŠ¡
- insert_task(graph_id, inserted_graph, return_point): æ’å…¥ä»»åŠ¡
- get_task_status(graph_id): è·å–ä»»åŠ¡çŠ¶æ€
```

**é™åˆ¶**ï¼š
- æœ€å¤š1ä¸ªä¸»ä»»åŠ¡ï¼ˆactiveçŠ¶æ€ï¼‰
- æœ€å¤š2ä¸ªæ’å…¥ä»»åŠ¡ï¼ˆåŒæ—¶å­˜åœ¨ï¼‰

### 2. èŠ‚ç‚¹æ‰§è¡Œå™¨ (`task_node_executor.py`)

**èŒè´£**ï¼šè°ƒç”¨å®é™…æ¨¡å—æ‰§è¡ŒèŠ‚ç‚¹ä»»åŠ¡

**æ”¯æŒèŠ‚ç‚¹ç±»å‹**ï¼š
- `navigation`: å¯¼èˆªèŠ‚ç‚¹
- `interaction`: ç”¨æˆ·äº¤äº’èŠ‚ç‚¹
- `observation`: è§‚å¯Ÿè¯†åˆ«èŠ‚ç‚¹
- `external_call`: å¤–éƒ¨æœåŠ¡è°ƒç”¨èŠ‚ç‚¹
- `memory_action`: è®°å¿†æ“ä½œèŠ‚ç‚¹
- `condition_check`: æ¡ä»¶æ£€æŸ¥èŠ‚ç‚¹

### 3. çŠ¶æ€ç®¡ç†å™¨ (`task_state_manager.py`)

**èŒè´£**ï¼šè®°å½•ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼ˆè¿›åº¦ã€èŠ‚ç‚¹ã€ä¸Šä¸‹æ–‡ï¼‰

**æ•°æ®ç»“æ„**ï¼š
```python
@dataclass
class TaskState:
    graph_id: str
    current_node: str
    progress: int  # 0-100
    started_at: float
    paused_at: float
    context: Dict[str, Any]
    interrupt_point: str
```

### 4. æ’å…¥ä»»åŠ¡é˜Ÿåˆ— (`inserted_task_queue.py`)

**èŒè´£**ï¼šç®¡ç†æ’å…¥ä»»åŠ¡ï¼Œè®°å½•çˆ¶ä»»åŠ¡å…³ç³»å’Œè¿”å›ç‚¹

**ä¸»è¦æ–¹æ³•**ï¼š
```python
- add_inserted_task(parent_id, inserted_id, return_point): æ·»åŠ æ’å…¥ä»»åŠ¡
- get_parent_task(inserted_id): è·å–çˆ¶ä»»åŠ¡ID
- get_return_point(inserted_id): è·å–è¿”å›ç‚¹
- remove_inserted_task(inserted_id): ç§»é™¤æ’å…¥ä»»åŠ¡
```

### 5. ç¼“å­˜ç®¡ç†å™¨ (`task_cache_manager.py`)

**èŒè´£**ï¼šLRUç¼“å­˜ç®¡ç†ï¼Œæœ€å¤šä¿ç•™3ä¸ªä»»åŠ¡

**ç¼“å­˜ç­–ç•¥**ï¼š
- æœ€æ–°è®¿é—®çš„ä»»åŠ¡åœ¨æœ€å‰é¢
- è¶…å‡ºå®¹é‡æ—¶è‡ªåŠ¨ç§»é™¤æœ€æ—§çš„ä»»åŠ¡
- æä¾›ç¼“å­˜ä½¿ç”¨æƒ…å†µæŸ¥è¯¢

### 6. ä»»åŠ¡æ¸…ç†å™¨ (`task_cleanup.py`)

**èŒè´£**ï¼šè‡ªåŠ¨æ¸…ç†å·²å®Œæˆ/è¶…æ—¶ä»»åŠ¡

**æ¸…ç†ç­–ç•¥**ï¼š
- å·²å®Œæˆä»»åŠ¡ï¼šå»¶è¿Ÿ2åˆ†é’Ÿåé‡Šæ”¾
- å–æ¶ˆä»»åŠ¡ï¼šç«‹å³é‡Šæ”¾
- è¶…æ—¶ä»»åŠ¡ï¼š60åˆ†é’Ÿæ— è¿›åº¦è‡ªåŠ¨å…³é—­
- åå°çº¿ç¨‹æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŠ è½½å¹¶æ‰§è¡Œä»»åŠ¡

```python
from task_engine import get_task_engine

# è·å–ä»»åŠ¡å¼•æ“
engine = get_task_engine()

# åŠ è½½ä»»åŠ¡å›¾
task_graph = engine.load_task_graph("task_graphs/hospital_visit.json")

# æ³¨å†Œä»»åŠ¡
graph_id = engine.register_task(task_graph)

# å¯åŠ¨ä»»åŠ¡
engine.start_task(graph_id)

# æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
status = engine.get_task_status(graph_id)
print(f"çŠ¶æ€: {status['status']}, è¿›åº¦: {status['progress']}%")
```

### æ’å…¥ä»»åŠ¡

```python
# åŠ è½½æ’å…¥ä»»åŠ¡
inserted_graph = engine.load_task_graph("task_graphs/buy_snack.json")

# åœ¨å½“å‰ä»»åŠ¡ä¸­æ’å…¥
engine.insert_task(
    current_graph_id=main_graph_id,
    inserted_graph=inserted_graph,
    return_point="navigate_toilet"
)
```

### æ£€æŸ¥ç¼“å­˜çŠ¶æ€

```python
cache_info = engine.get_cache_info()
print(f"ç¼“å­˜ä½¿ç”¨: {cache_info['current_size']}/{cache_info['max_size']}")
print(f"æ´»åŠ¨ä»»åŠ¡: {cache_info['active_tasks']}")
print(f"å·²å®Œæˆä»»åŠ¡: {cache_info['completed_tasks']}")
```

---

# Luna Badge v1.4 - æœ€å°ä»»åŠ¡å¼•æ“å­ç³»ç»Ÿ

## ğŸ“š é¡¹ç›®æ¦‚è¿°

Luna Badge v1.4æœ€å°ä»»åŠ¡å¼•æ“å­ç³»ç»Ÿï¼Œä¸“ä¸ºè§†éšœåœºæ™¯æ‰“é€ ï¼Œå…·å¤‡æ—¥å¿—ä¸Šä¼ ã€ç¼“å­˜æ§åˆ¶ã€æ’å…¥ä»»åŠ¡æ”¯æŒç­‰èƒ½åŠ›ã€‚

**è®¾è®¡åŸåˆ™ï¼š**
- âœ… å¯è½åœ°ï¼šæœ€å°åŒ–å®ç°ï¼Œæ˜“äºé›†æˆ
- âœ… å¯é›†æˆï¼šç‹¬ç«‹æ¨¡å—ï¼Œä¾¿äºé›†æˆåˆ°ä¸»ç³»ç»Ÿ
- âœ… å¯æ§ç¼“å­˜ï¼šä¸¥æ ¼é™åˆ¶èµ„æºå ç”¨

---

## ğŸ“ ç›®å½•ç»“æ„

```
task_engine/
â”œâ”€â”€ task_engine.py                  # âœ… ä»»åŠ¡å¼•æ“å…¥å£
â”œâ”€â”€ task_graph_loader.py           # âœ… ä»»åŠ¡å›¾åŠ è½½å™¨
â”œâ”€â”€ task_node_executor.py          # âœ… èŠ‚ç‚¹æ‰§è¡Œå™¨
â”œâ”€â”€ task_state_manager.py          # âœ… çŠ¶æ€ç®¡ç†å™¨
â”œâ”€â”€ task_cache_manager.py          # âœ… ç¼“å­˜ç®¡ç†å™¨
â”œâ”€â”€ inserted_task_queue.py         # âœ… æ’å…¥ä»»åŠ¡é˜Ÿåˆ—
â”œâ”€â”€ task_cleanup.py                # âœ… ä»»åŠ¡æ¸…ç†å™¨
â”œâ”€â”€ task_report_uploader.py        # âœ… æŠ¥å‘Šä¸Šä¼ å™¨
â”œâ”€â”€ __init__.py                    # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ README.md                      # æœ¬æ–‡æ¡£
â”œâ”€â”€ DEVELOPMENT_REPORT.md          # å¼€å‘æŠ¥å‘Š
â””â”€â”€ test_integration.py            # é›†æˆæµ‹è¯•

task_graphs/
â”œâ”€â”€ hospital_visit.json             # âœ… åŒ»é™¢å°±è¯Šä»»åŠ¡é“¾
â””â”€â”€ sample_inserted_task.json      # âœ… æ’å…¥ä»»åŠ¡ç¤ºä¾‹
```

---

## ğŸ§© æ¨¡å—è¯´æ˜

### 1. task_engine.py - ä»»åŠ¡å¼•æ“å…¥å£

**èŒè´£ï¼š**è°ƒåº¦ä»»åŠ¡å›¾ã€åŠ è½½æ‰§è¡Œå™¨ã€æ§åˆ¶çŠ¶æ€ã€æ‰§è¡ŒèŠ‚ç‚¹

**åŠŸèƒ½ç‚¹ï¼š**
- åŠ è½½task_graphï¼Œåˆå§‹åŒ–è¿è¡Œ
- é‡åˆ°æ’å…¥ä»»åŠ¡æ—¶æš‚åœä¸»ä»»åŠ¡
- èŠ‚ç‚¹æ‰§è¡Œå®Œæ¯•å†™å…¥çŠ¶æ€
- è°ƒç”¨æ—¥å¿—ä¸Šä¼ æ¨¡å—ä¸ŠæŠ¥å®Œæˆæƒ…å†µ

**æ¥å£ï¼š**
```python
engine = get_task_engine()
graph = engine.load_task_graph("task_graphs/hospital_visit.json")
graph_id = engine.register_task(graph)
engine.start_task(graph_id)
status = engine.get_task_status(graph_id)
```

### 2. task_graph_loader.py - ä»»åŠ¡å›¾åŠ è½½å™¨

**èŒè´£ï¼š**ä».jsonæ–‡ä»¶åŠ è½½æ ‡å‡†ä»»åŠ¡å›¾å¯¹è±¡

**åŠŸèƒ½ç‚¹ï¼š**
- æ ¡éªŒå­—æ®µå®Œæ•´æ€§
- æ”¯æŒé¢„è®¾è·¯å¾„æˆ–é€šè¿‡APIè·å–å›¾è°±ï¼ˆé¢„ç•™ï¼‰
- è¿”å›ç»“æ„åŒ–TaskGraphå¯¹è±¡

**æ¥å£ï¼š**
```python
loader = get_graph_loader()
graph = loader.load_from_file("hospital_visit.json")
# é¢„ç•™ï¼šgraph = loader.load_from_api("graph_id")
```

### 3. task_node_executor.py - èŠ‚ç‚¹æ‰§è¡Œå™¨

**èŒè´£ï¼š**æŒ‰ç±»å‹è°ƒåº¦å¯¹åº”åŠŸèƒ½æ¨¡å—ï¼ˆå¯¼èˆªã€æ’­æŠ¥ã€è¯­éŸ³è¯†åˆ«ç­‰ï¼‰

**åŠŸèƒ½ç‚¹ï¼š**
- æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œé€»è¾‘éš”ç¦»
- çŠ¶æ€æœºæ§åˆ¶ï¼špending â†’ running â†’ complete
- å›ä¼ èŠ‚ç‚¹è¾“å‡ºç»“æœåˆ°çŠ¶æ€ç®¡ç†å™¨

**æ”¯æŒçš„èŠ‚ç‚¹ç±»å‹ï¼š**
- `navigation`: å¯¼èˆªç›¸å…³ä»»åŠ¡
- `interaction`: ä¸ç”¨æˆ·å¯¹è¯/é—®è¯¢
- `observation`: è§†è§‰/è¯­éŸ³è¯†åˆ«
- `external_call`: è”åŠ¨å¤–éƒ¨æœåŠ¡
- `memory_action`: è®°å¿†å†™å…¥/ä¿®æ”¹/è°ƒå–
- `condition_check`: åˆ¤æ–­ç¯å¢ƒ/çŠ¶æ€

### 4. task_state_manager.py - ä»»åŠ¡çŠ¶æ€è®°å½•å™¨

**èŒè´£ï¼š**è®°å½•ä»»åŠ¡é“¾æ‰§è¡ŒçŠ¶æ€ã€èŠ‚ç‚¹çŠ¶æ€ã€æ’å…¥ç‚¹ã€æ¢å¤ç‚¹

**åŠŸèƒ½ç‚¹ï¼š**
- æ”¯æŒåºåˆ—åŒ–ä¸ºJSON
- æ”¯æŒç³»ç»Ÿæ¢å¤åé‡è½½
- æš‚åœåä¿ç•™çŠ¶æ€è‡³task_cache_manager

**çŠ¶æ€æ–‡ä»¶ä½ç½®ï¼š**`data/task_states/`

### 5. task_cache_manager.py - ç¼“å­˜ç®¡ç†å™¨

**èŒè´£ï¼š**ç®¡ç†æœ€å¤šä¿ç•™3æ¡ä»»åŠ¡ç¼“å­˜ï¼ˆ1ä¸»ä»»åŠ¡ + 2æ’å…¥ï¼‰

**åŠŸèƒ½ç‚¹ï¼š**
- æ¸…ç†å·²å®Œæˆ/åºŸå¼ƒä»»åŠ¡
- æ—¶é—´æˆ³è¿‡æœŸè‡ªåŠ¨å›æ”¶
- LRUç¼“å­˜ç­–ç•¥

### 6. inserted_task_queue.py - æ’å…¥ä»»åŠ¡è°ƒåº¦å™¨

**èŒè´£ï¼š**å¤„ç†ç”¨æˆ·ä¸­é€”æ’å…¥çš„å°ä»»åŠ¡ï¼ˆå¦‚å¦‚å•ã€è´­ç‰©ï¼‰

**åŠŸèƒ½ç‚¹ï¼š**
- è®°å½•æ’å…¥ç‚¹ä½ç½®
- å®Œæˆåè·³å›ä¸»ä»»åŠ¡
- ä¸task_engineè”åŠ¨åˆ‡æ¢ä»»åŠ¡ä¸Šä¸‹æ–‡

### 7. task_cleanup.py - è¶…æ—¶ä¸å›æ”¶æœºåˆ¶

**èŒè´£ï¼š**å®šæ—¶æ¸…ç†å·²å®Œæˆ/å¤±è´¥/è¶…æ—¶ä»»åŠ¡

**åŠŸèƒ½ç‚¹ï¼š**
- 2åˆ†é’Ÿå†…æœªè®¿é—®è‡ªåŠ¨ç§»å‡ºç¼“å­˜
- æ¯æ—¥æ¸…ç†ä»»åŠ¡æ—¥å¿—
- æ—¥å¿—ä¿ç•™ç­–ç•¥ï¼ˆ30å¤©ï¼‰

### 8. task_report_uploader.py - æ‰§è¡Œè®°å½•ä¸Šä¼ æ¨¡å—

**èŒè´£ï¼š**å°†ä»»åŠ¡è¿è¡Œæ•°æ®ä¸Šä¼ è‡³äº‘ç«¯åå°

**åŠŸèƒ½ç‚¹ï¼š**
- ä¸Šä¼ å­—æ®µï¼štask_idã€user_idã€å›¾è°±åã€æ‰§è¡Œé“¾è·¯ã€å¤±è´¥èŠ‚ç‚¹ã€ä¿®æ­£è¡Œä¸ºç­‰
- æ”¯æŒé‡è¯•ä¸å¤±è´¥æœ¬åœ°ä¿å­˜
- APIåœ°å€ï¼š`https://api.luna.ai/task/report`ï¼ˆå ä½ï¼‰

**æ¥å£ï¼š**
```python
uploader = get_report_uploader()
success = uploader.upload_task_report({
    "task_id": "graph_id",
    "user_id": "user_id",
    "graph_name": "ä»»åŠ¡åç§°",
    "execution_path": ["node1", "node2"],
    "failed_nodes": [],
    "duration": 1800,
    "status": "completed"
})
```

---

## ğŸ”§ ç³»ç»Ÿé™åˆ¶ï¼ˆv1.4ï¼‰

| ç±»å‹ | é™åˆ¶æ¡ä»¶ |
|------|----------|
| **ä¸»ä»»åŠ¡é“¾** | ä»…æ”¯æŒ 1 ä¸ª active |
| **æ’å…¥ä»»åŠ¡é“¾** | åŒæ—¶æœ€å¤šå­˜åœ¨ 2 ä¸ªï¼ˆè¿›è¡Œä¸­ + æš‚åœï¼‰ |
| **æ¢å¤æœºåˆ¶** | æ’å…¥ä»»åŠ¡å®Œæˆåï¼Œå›åˆ°ä¸»ä»»åŠ¡ä¸­æ–­ç‚¹ |
| **æ¸…ç†æœºåˆ¶** | å·²å®Œæˆ / ä¸¢å¼ƒä»»åŠ¡ â†’ å»¶è¿Ÿ 2 åˆ†é’Ÿåè‡ªåŠ¨é‡Šæ”¾ |
| **è¶…æ—¶ä»»åŠ¡** | 60åˆ†é’Ÿæ— è¿›åº¦ â†’ å¼ºåˆ¶å…³é—­ï¼ˆè®°å½•ä¸ºå¼‚å¸¸ï¼‰ |
| **ç¼“å­˜é™åˆ¶** | æœ€å¤š3ä¸ªä»»åŠ¡ï¼ˆ1ä¸»ä»»åŠ¡ + 2æ’å…¥ä»»åŠ¡ï¼‰ |

---

## ğŸ“‹ ä»»åŠ¡å›¾JSONæ ¼å¼

```json
{
  "graph_id": "hospital_visit",
  "scene": "hospital",
  "goal": "å®Œæˆä¸€æ¬¡æŒ‚å·å°±è¯Š",
  "name": "åŒ»é™¢å°±è¯Šæµç¨‹",
  "description": "å®Œæ•´çš„åŒ»é™¢å°±è¯Šæµç¨‹",
  "nodes": [
    {
      "id": "plan_route",
      "type": "navigation",
      "title": "è§„åˆ’è·¯çº¿",
      "input": "åŒ»é™¢åç§°",
      "output": "è·¯çº¿ä¿¡æ¯",
      "fallback": "manual_ask",
      "config": {
        "destination": "è™¹å£åŒ»é™¢",
        "transport_mode": "walking"
      },
      "timeout": 300
    }
  ],
  "edges": [
    {"from": "plan_route", "to": "next_node"}
  ],
  "metadata": {
    "estimated_duration": 120,
    "complexity": "high"
  }
}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```python
from task_engine import get_task_engine

# 1. è·å–ä»»åŠ¡å¼•æ“
engine = get_task_engine()

# 2. åŠ è½½ä»»åŠ¡å›¾
task_graph = engine.load_task_graph("task_graphs/hospital_visit.json")

# 3. æ³¨å†Œä»»åŠ¡
graph_id = engine.register_task(task_graph)

# 4. å¯åŠ¨ä»»åŠ¡
engine.start_task(graph_id)

# 5. æ£€æŸ¥çŠ¶æ€
status = engine.get_task_status(graph_id)
print(f"çŠ¶æ€: {status['status']}, è¿›åº¦: {status['progress']}%")
```

### æ’å…¥ä»»åŠ¡

```python
# åŠ è½½æ’å…¥ä»»åŠ¡
inserted_graph = engine.load_task_graph("task_graphs/sample_inserted_task.json")

# æ’å…¥åˆ°å½“å‰ä»»åŠ¡
engine.insert_task(main_graph_id, inserted_graph, return_point="node_id")
```

### æš‚åœ/æ¢å¤ä»»åŠ¡

```python
# æš‚åœä»»åŠ¡
engine.pause_task(graph_id)

# æ¢å¤ä»»åŠ¡
engine.resume_task(graph_id)
```

---

## ğŸ§ª æµ‹è¯•

è¿è¡Œé›†æˆæµ‹è¯•ï¼š

```bash
cd Luna_Badge
python3 task_engine/test_integration.py
```

---

## ğŸ“Š æ•°æ®å­˜å‚¨

- **ä»»åŠ¡çŠ¶æ€æ–‡ä»¶ï¼š** `data/task_states/*.json`
- **å¾…ä¸Šä¼ æŠ¥å‘Šï¼š** `data/task_reports_pending.json`
- **ä»»åŠ¡æ—¥å¿—ï¼š** `data/task_logs/*`ï¼ˆä¿ç•™30å¤©ï¼‰

---

## ğŸ”® åç»­æ¼”è¿›

1. **v1.5**: å¢åŠ è¯­éŸ³æ§åˆ¶æ¥å£
2. **v1.6**: é›†æˆé•¿æœŸè®°å¿†ç³»ç»Ÿ
3. **v2.0**: å®Œæ•´ä»»åŠ¡ä¸­å¿ƒ + AIç”Ÿæˆä»»åŠ¡

---

## ğŸ“ å¼€å‘è§„èŒƒ

- æ‰€æœ‰æ¨¡å—éœ€å…·å¤‡ç‹¬ç«‹åˆå§‹åŒ–å‡½æ•°ï¼Œä¾¿äºä¸»æ§æ³¨å†Œ
- æ¯ä¸ªæ¨¡å—éœ€æä¾›æ¸…æ™°çš„è¾“å…¥/è¾“å‡ºæ¥å£
- æ‰€æœ‰ä»»åŠ¡çŠ¶æ€æ–‡ä»¶å­˜å…¥ `/data/task_states/`
- ä»»åŠ¡æ—¥å¿—ä¸Šä¼ æ¥å£ç»Ÿä¸€ä¸ºï¼š`https://api.luna.ai/task/report`

---

## âœ… éªŒè¯ç»“æœ

```
âœ… 8/8 æ¨¡å—å¯¼å…¥æˆåŠŸ
âœ… TaskEngineåˆå§‹åŒ–æˆåŠŸ
âœ… TaskGraphLoaderåˆå§‹åŒ–æˆåŠŸ
âœ… TaskReportUploaderåˆå§‹åŒ–æˆåŠŸ
âœ… ç¼“å­˜ä¿¡æ¯æŸ¥è¯¢æˆåŠŸ
âœ… é›†æˆæµ‹è¯•é€šè¿‡
```

---

**Luna Badge v1.4 æœ€å°ä»»åŠ¡å¼•æ“å­ç³»ç»Ÿå¼€å‘å®Œæˆï¼** ğŸ‰

### âœ… è½»é‡çº§
- æœ€å°åŒ–ä¾èµ–
- ç®€å•çš„JSONä»»åŠ¡å®šä¹‰
- é«˜æ•ˆçš„å†…å­˜ç®¡ç†

### âœ… å¯æ§
- ä¸¥æ ¼çš„ä»»åŠ¡æ•°é‡é™åˆ¶
- è‡ªåŠ¨è¶…æ—¶æ£€æµ‹
- å»¶è¿Ÿæ¸…ç†æœºåˆ¶

### âœ… å¯æ‰©å±•
- æ”¯æŒè‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹
- çµæ´»çš„ä»»åŠ¡å›¾ç»“æ„
- æ˜“äºé›†æˆåˆ°ä¸»ç³»ç»Ÿ

### âœ… å¯é 
- çŠ¶æ€æŒä¹…åŒ–
- é”™è¯¯å¤„ç†å’Œæ¢å¤
- åå°è‡ªåŠ¨æ¸…ç†

---

## ğŸ”® æœªæ¥æ¼”è¿›è·¯å¾„

å½“å‰v1.4 â†’ é€æ­¥æ¼”è¿›ä¸ºå®Œæ•´TaskHub

1. **v1.4**: æœ€å°ä»»åŠ¡å¼•æ“ï¼ˆå½“å‰ï¼‰
2. **v1.5**: å¢åŠ è¯­éŸ³æ§åˆ¶æ¥å£
3. **v1.6**: é›†æˆé•¿æœŸè®°å¿†ç³»ç»Ÿ
4. **v2.0**: å®Œæ•´ä»»åŠ¡ä¸­å¿ƒ + AIç”Ÿæˆä»»åŠ¡

---

## ğŸ“Š æµ‹è¯•ç»“æœ

```
ğŸš€ Luna Badge v1.4 ä»»åŠ¡å¼•æ“æµ‹è¯•
âœ… ä»»åŠ¡å›¾åŠ è½½æˆåŠŸ
âœ… ä»»åŠ¡æ³¨å†ŒæˆåŠŸ
âœ… ä»»åŠ¡å¯åŠ¨æˆåŠŸ
âœ… ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢æ­£å¸¸
âœ… ç¼“å­˜ç®¡ç†æ­£å¸¸
âœ… ä»»åŠ¡é™åˆ¶æ£€æŸ¥é€šè¿‡
```

---

## ğŸ¯ æ€»ç»“

**Luna Badge v1.4 æœ€å°ä»»åŠ¡å¼•æ“å­ç³»ç»Ÿ**å·²æˆåŠŸæ„å»ºï¼

- âœ… å®Œæ•´å®ç°äº†ä»»åŠ¡å¼•æ“æ ¸å¿ƒåŠŸèƒ½
- âœ… æ”¯æŒå¤šä»»åŠ¡é“¾ç®¡ç†å’Œæ’å…¥æœºåˆ¶
- âœ… ä¸¥æ ¼çš„èµ„æºæ§åˆ¶å’Œè‡ªåŠ¨æ¸…ç†
- âœ… å¯è½åœ°çš„å®ç°ï¼Œæ˜“äºé›†æˆ
- âœ… ä¸ºæœªæ¥æ‰©å±•å¥ å®šäº†åšå®åŸºç¡€

**å¯ä»¥å¼€å§‹é›†æˆåˆ°ä¸»ç³»ç»Ÿï¼Œé€æ­¥æ¼”åŒ–ä¸ºå®Œæ•´çš„Task Hubï¼** ğŸš€
