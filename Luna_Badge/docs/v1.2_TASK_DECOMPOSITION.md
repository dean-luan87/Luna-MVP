# Luna Badge v1.2 ä»»åŠ¡æ‹†è§£ï¼šå‰©ä½™åŠŸèƒ½æ¨¡å—

**ç‰ˆæœ¬**: v1.2  
**å¼€å‘æ—¶é—´**: 2025å¹´10æœˆ  
**çŠ¶æ€**: è§„åˆ’ä¸­  
**å‰ç½®ç‰ˆæœ¬**: v1.4ï¼ˆä»»åŠ¡å¼•æ“å­ç³»ç»Ÿå·²å®Œæˆï¼‰

---

## ğŸ“‹ æ¨¡å—åˆ—è¡¨

### æ¨¡å— 1ï¼šå°é˜¶è¯†åˆ« Ã— æ•°æ®æŒä¹…åŒ–

#### 1.1 å°é˜¶è¯†åˆ«åŠŸèƒ½
**æ–‡ä»¶**: `core/step_detector.py`

**åŠŸèƒ½**:
- è¯†åˆ«æ¥¼æ¢¯/å°é˜¶
- é€šè¿‡æ·±åº¦ä¼°è®¡æˆ–è§†è§‰ç‰¹å¾åˆ¤æ–­
- æ£€æµ‹å°é˜¶é«˜åº¦ã€å®½åº¦ã€æ•°é‡
- åˆ¤æ–­å°é˜¶æ–¹å‘ï¼ˆä¸Š/ä¸‹ï¼‰
- è¾“å‡ºç»“æ„åŒ–æ•°æ®

**è¾“å‡ºæ ¼å¼**:
```json
{
  "event": "step_detected",
  "level": "medium",
  "data": {
    "steps_count": 5,
    "direction": "up",
    "height_avg": "15cm",
    "width_avg": "30cm",
    "bbox": [100, 150, 200, 400],
    "confidence": 0.85
  },
  "timestamp": "2025-10-29T15:30:00"
}
```

#### 1.2 æ•°æ®æŒä¹…åŒ–
**æ–‡ä»¶**: `core/migrate_step_data_on_device_change.py`

**åŠŸèƒ½**:
- è®°å½•è¯†åˆ«æ•°æ®å¹¶æŒä¹…åŒ–è‡³æœ¬åœ°å­˜å‚¨
- ç»‘å®šè´¦å·ID
- æ›´æ¢è®¾å¤‡æ—¶è‡ªåŠ¨è¿ç§»å°é˜¶/ç»“æ„è¯†åˆ«æ•°æ®
- å®ç°çŠ¶æ€è¿˜åŸ

**å­˜å‚¨ä½ç½®**: `data/step_records.json`

**æ•°æ®æ ¼å¼**:
```json
{
  "account_id": "user_001",
  "records": [
    {
      "step_id": "step_001",
      "location": {"lat": 31.2304, "lng": 121.4737},
      "steps_count": 5,
      "direction": "up",
      "first_detected": "2025-10-28T10:00:00",
      "last_visited": "2025-10-29T14:30:00",
      "visit_count": 3
    }
  ]
}
```

---

### æ¨¡å— 2ï¼šé¦–æ¬¡å¼€æœºæµç¨‹

#### 2.1 é¦–æ¬¡å¼€æœºæ£€æµ‹
**æ–‡ä»¶**: `core/first_boot_check.py`

**åŠŸèƒ½**:
- åˆ¤æ–­æ˜¯å¦é¦–æ¬¡å¼€æœº
- è¿›å…¥åˆå§‹åŒ–æµç¨‹
- åˆ›å»ºå¿…è¦çš„é…ç½®æ–‡ä»¶å’Œç›®å½•

**æ£€æµ‹é€»è¾‘**:
```python
def first_boot_check():
    if not os.path.exists("data/user_profile.json"):
        return True  # é¦–æ¬¡å¼€æœº
    return False
```

#### 2.2 è´¦å·è®¾ç½®æµç¨‹
**æ–‡ä»¶**: `core/account_setup_flow.py`

**åŠŸèƒ½**:
- åˆ›å»ºæ–°è´¦å·
- ç»§æ‰¿è€è´¦å·
- æ”¯æŒè¯­éŸ³å¼•å¯¼é…ç½‘
- æ‰«ç é…å¯¹æœºåˆ¶

**æµç¨‹**:
1. æ£€æµ‹æ˜¯å¦ä¸ºé¦–æ¬¡å¼€æœº
2. å¦‚æœæ˜¯é¦–æ¬¡ï¼Œåˆ›å»ºæ–°è´¦å·
3. å¦‚æœä¸æ˜¯ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è´¦å·å¤‡ä»½
4. è¯­éŸ³å¼•å¯¼ç”¨æˆ·é€‰æ‹©ï¼š
   - åˆ›å»ºæ–°è´¦å·
   - ç»§æ‰¿è€è´¦å·ï¼ˆé€šè¿‡æ‰«ç æˆ–è´¦å·å¯†ç ï¼‰
5. å®Œæˆç½‘ç»œé…ç½®

**è¾“å‡ºæ ¼å¼**:
```json
{
  "event": "account_setup_complete",
  "level": "system",
  "data": {
    "account_id": "user_001",
    "account_type": "new",
    "network_configured": true
  },
  "timestamp": "2025-10-29T15:30:00"
}
```

---

### æ¨¡å— 3ï¼šäº§å“è¯­éŸ³å¼•å¯¼ç³»ç»Ÿ

#### 3.1 è¯­éŸ³å¼•å¯¼åŠŸèƒ½
**æ–‡ä»¶**: `core/luna_usage_guide.py`

**åŠŸèƒ½**:
- ä¾æ®æ¨¡å—åŒ–å†…å®¹ç»“æ„è¿›è¡Œé€æ­¥è¯­éŸ³å¼•å¯¼
- åå°å¯é…ç½®å¼•å¯¼å†…å®¹
- æ”¯æŒè§¦å‘å…³é”®è¯å”¤èµ·

**è§¦å‘æ–¹å¼**:
- é¦–æ¬¡å¯åŠ¨è‡ªåŠ¨è§¦å‘
- ç”¨æˆ·è¯­éŸ³ï¼š"Lunaï¼Œæ€ä¹ˆç”¨ï¼Ÿ"
- ç”¨æˆ·è¯­éŸ³ï¼š"Lunaï¼Œå¸®åŠ©"

**å¼•å¯¼å†…å®¹**:
```python
guide_steps = [
    "æ¬¢è¿ä½¿ç”¨Lunaå¾½ç« ï¼Œæˆ‘æ˜¯ä½ çš„è§†è§‰ä¸è¯­éŸ³å¯¼èˆªåŠ©æ‰‹ã€‚",
    "æˆ‘å¯ä»¥ä¸ºä½ å¯¼èˆªã€è¯†åˆ«è·¯æ ‡ã€è®°å½•æé†’ï¼Œè¿˜å¯ä»¥å›ç­”ä½ çš„é—®é¢˜ã€‚",
    "ä½ å¯ä»¥éšæ—¶è¯´ï¼šLunaï¼Œæ€ä¹ˆç”¨ï¼Ÿ æ¥å†æ¬¡å¬åˆ°è¿™æ®µä»‹ç»ã€‚",
    "Lunaå¾½ç« æ”¯æŒå¤šç§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š",
    "1. æ™ºèƒ½å¯¼èˆªï¼Œä¸ºä½ è§„åˆ’æœ€ä¼˜è·¯çº¿",
    "2. éšœç¢ç‰©è¯†åˆ«ï¼Œæé†’ä½ æ³¨æ„å®‰å…¨",
    "3. è®°å¿†åŠŸèƒ½ï¼Œè®°å½•ä½ çš„é‡è¦äº‹é¡¹",
    "4. è¯­éŸ³äº¤äº’ï¼Œéšæ—¶ä¸ºä½ æœåŠ¡",
    "å¼€å§‹ä½¿ç”¨å§ï¼Œæˆ‘ä¼šé™ªä¼´ä½ æ¯ä¸€æ­¥ï¼"
]
```

**è¾“å‡ºæ ¼å¼**:
```json
{
  "event": "usage_guide_started",
  "level": "system",
  "data": {
    "trigger": "first_boot",
    "guide_type": "introduction",
    "step_count": 5
  },
  "timestamp": "2025-10-29T15:30:00"
}
```

---

### æ¨¡å— 4ï¼šç¡¬ä»¶ç¼–ç è®°å½•æœºåˆ¶

#### 4.1 ç¡¬ä»¶èº«ä»½è®°å½•
**æ–‡ä»¶**: `core/hardware_identity_logger.py`

**åŠŸèƒ½**:
- è®°å½•ç¡¬ä»¶åºåˆ—å·
- æ¿€æ´»æ—¶é—´
- ä½¿ç”¨æ—¥å¿—
- ä¸è´¦å·ç»‘å®š
- å¯ä¸Šä¼ è‡³åå°

**è®°å½•å†…å®¹**:
```json
{
  "hardware_id": "LUNA-DEVICE-001",
  "serial_number": "SN12345678",
  "activated_at": "2025-10-29T15:00:00",
  "account_id": "user_001",
  "device_info": {
    "model": "Luna Badge v1.2",
    "firmware_version": "v1.2.0",
    "manufacturing_date": "2025-09-15"
  },
  "usage_log": [
    {
      "timestamp": "2025-10-29T15:00:00",
      "event": "activated",
      "action": "first_boot"
    }
  ]
}
```

**å­˜å‚¨ä½ç½®**: `data/hardware_identity.json`

---

### æ¨¡å— 5ï¼šè”ç½‘æœºåˆ¶è®¾è®¡

#### 5.1 è”ç½‘ç­–ç•¥
**æ–‡ä»¶**: `core/network_connection_strategy.py`

**åŠŸèƒ½**:
1. Wi-Fiç›´è¿ï¼šé¦–æ¬¡é…ç½‘æ”¯æŒè¯­éŸ³æŒ‡å¼•æˆ–äºŒç»´ç æ‰«ç 
2. è“ç‰™é…å¯¹è¾…åŠ©è”ç½‘ï¼ˆå¯é€‰ï¼‰
3. IoTå¡/eSIMé¢„ç•™ï¼ˆæš‚ä¸å¼€å‘ï¼‰

**Wi-Fié…ç½‘æµç¨‹**:
1. æ£€æµ‹ç½‘ç»œçŠ¶æ€
2. å¦‚æœæœªè¿æ¥ï¼Œå¯åŠ¨é…ç½‘æµç¨‹
3. è¯­éŸ³å¼•å¯¼ç”¨æˆ·ï¼š
   - "è¯·æ‰«æè®¾å¤‡ä¸Šçš„äºŒç»´ç è¿æ¥ç½‘ç»œ"
   - æˆ–è€…ï¼š"è¯·å‘Šè¯‰æˆ‘Wi-Fiåç§°å’Œå¯†ç "
4. è¿æ¥åˆ°Wi-Fi
5. éªŒè¯ç½‘ç»œè¿æ¥

**è¾“å‡ºæ ¼å¼**:
```json
{
  "event": "network_connected",
  "level": "system",
  "data": {
    "ssid": "Home_WiFi",
    "method": "qr_code",
    "signal_strength": -45,
    "ip_address": "192.168.1.100"
  },
  "timestamp": "2025-10-29T15:30:00"
}
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
Luna_Badge/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ step_detector.py                   # æ¨¡å—1ï¼šå°é˜¶è¯†åˆ«
â”‚   â”œâ”€â”€ migrate_step_data_on_device_change.py  # æ¨¡å—1ï¼šæ•°æ®è¿ç§»
â”‚   â”œâ”€â”€ first_boot_check.py                # æ¨¡å—2ï¼šé¦–æ¬¡å¼€æœºæ£€æµ‹
â”‚   â”œâ”€â”€ account_setup_flow.py              # æ¨¡å—2ï¼šè´¦å·è®¾ç½®æµç¨‹
â”‚   â”œâ”€â”€ luna_usage_guide.py                # æ¨¡å—3ï¼šè¯­éŸ³å¼•å¯¼ç³»ç»Ÿ
â”‚   â”œâ”€â”€ hardware_identity_logger.py        # æ¨¡å—4ï¼šç¡¬ä»¶ç¼–ç è®°å½•
â”‚   â””â”€â”€ network_connection_strategy.py     # æ¨¡å—5ï¼šè”ç½‘æœºåˆ¶
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ step_records.json                  # å°é˜¶è¯†åˆ«è®°å½•
â”‚   â”œâ”€â”€ hardware_identity.json             # ç¡¬ä»¶èº«ä»½è®°å½•
â”‚   â””â”€â”€ usage_guide.json                   # è¯­éŸ³å¼•å¯¼é…ç½®
â””â”€â”€ docs/
    â””â”€â”€ v1.2_TASK_DECOMPOSITION.md         # æœ¬æ–‡æ¡£
```

---

## ğŸ¯ å¼€å‘ä¼˜å…ˆçº§

| æ¨¡å— | ä¼˜å…ˆçº§ | ä¾èµ–å…³ç³» | é¢„è®¡å·¥ä½œé‡ |
|------|--------|----------|-----------|
| æ¨¡å—2ï¼šé¦–æ¬¡å¼€æœºæµç¨‹ | P0 | æ—  | 2å¤© |
| æ¨¡å—3ï¼šè¯­éŸ³å¼•å¯¼ç³»ç»Ÿ | P0 | æ¨¡å—2 | 1å¤© |
| æ¨¡å—4ï¼šç¡¬ä»¶ç¼–ç è®°å½• | P1 | æ¨¡å—2 | 1å¤© |
| æ¨¡å—5ï¼šè”ç½‘æœºåˆ¶ | P1 | æ¨¡å—2 | 2å¤© |
| æ¨¡å—1ï¼šå°é˜¶è¯†åˆ« | P2 | æ—  | 3å¤© |

**æ€»è®¡é¢„è®¡å·¥ä½œé‡**: 9å¤©

---

## ğŸ“ åç»­è¡¥å……

### è¯­éŸ³å¼•å¯¼æ–‡æ¡ˆç»“æ„
- æ”¯æŒå¤šè¯­è¨€åˆ‡æ¢
- æ”¯æŒè‡ªå®šä¹‰å¼•å¯¼å†…å®¹
- æ”¯æŒåˆ†æ­¥éª¤æ’­æ”¾

### è”ç½‘ç•Œé¢
- äºŒç»´ç ç”Ÿæˆç•Œé¢
- ç½‘ç»œè¿æ¥çŠ¶æ€æ˜¾ç¤º
- Wi-Fiåˆ—è¡¨æ˜¾ç¤º

### è´¦æˆ·è¾“å…¥æ–¹å¼
- è¯­éŸ³è¾“å…¥è´¦å·
- æ‰«ç ç»‘å®šè´¦å·
- è´¦å·å¯†ç ç™»å½•

---

**æ–‡æ¡£ç”Ÿæˆæ—¥æœŸ**: 2025-10-29  
**ç‰ˆæœ¬**: v1.2  
**çŠ¶æ€**: è§„åˆ’ä¸­
