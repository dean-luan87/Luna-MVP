# Luna Badge ç³»ç»Ÿæ¶æ„

## ğŸ“ æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Luna Badge ç³»ç»Ÿ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§†è§‰æ„ŸçŸ¥å±‚      â”‚ â† YOLO+DeepSort / OCR / SLAM
â”‚  Vision Layer   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·¯å¾„åˆ¤æ–­å±‚      â”‚ â† äººç¾¤å¯†åº¦ / æ–¹å‘ä¸€è‡´æ€§ / éšœç¢é˜»æŒ¡
â”‚  Path Layer     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ’­æŠ¥ç­–ç•¥å±‚      â”‚ â† æƒ…ç»ªæ’­æŠ¥é£æ ¼åˆ‡æ¢ + å†…å®¹æ¨¡æ¿
â”‚  Speech Layer   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·äº¤äº’å±‚      â”‚ â† è¯­éŸ³åé¦ˆ / çº é”™ / è·¯çº¿ç¡®è®¤
â”‚  User Layer     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ æ¶æ„åˆ†å±‚è¯¦è§£

### 1. è§†è§‰æ„ŸçŸ¥å±‚ (Vision Layer)

**èŒè´£**: è§†è§‰ä¿¡æ¯é‡‡é›†ã€è¯†åˆ«å’Œç†è§£

#### æ ¸å¿ƒæ¨¡å—
```python
# ç‰©ä½“æ£€æµ‹ä¸è¿½è¸ª
- YOLO: ç‰©ä½“æ£€æµ‹ (è¡Œäººã€è½¦è¾†ã€éšœç¢ç‰©)
- DeepSort: ç›®æ ‡è¿½è¸ª (è½¨è¿¹é¢„æµ‹)

# OCRè¯†åˆ«
- OCRæ–‡æ¡£è¯†åˆ«: ocr_advanced_reader.py
- å•†å“ä¿¡æ¯è¯†åˆ«: product_info_checker.py
- é—¨ç‰Œè¯†åˆ«: doorplate_reader.py

# SLAMåœ°å›¾ç”Ÿæˆ
- å±€éƒ¨åœ°å›¾ç”Ÿæˆ: local_map_generator.py
```

#### è¾“å‡ºæ•°æ®
```json
{
  "event": "vision_detection",
  "level": "medium",
  "data": {
    "objects": [
      {"type": "person", "position": [100, 200], "confidence": 0.9},
      {"type": "vehicle", "position": [300, 400], "confidence": 0.8}
    ],
    "signboards": [
      {"type": "toilet", "text": "æ´—æ‰‹é—´", "position": [50, 100]}
    ],
    "hazards": [
      {"type": "water", "severity": "high", "position": [200, 300]}
    ]
  },
  "timestamp": "..."
}
```

---

### 2. è·¯å¾„åˆ¤æ–­å±‚ (Path Layer)

**èŒè´£**: åˆ†æè·¯å¾„çŠ¶æ€ã€äººç¾¤è¡Œä¸ºã€éšœç¢ç‰©

#### æ ¸å¿ƒæ¨¡å—
```python
# äººç¾¤è¡Œä¸ºåˆ†æ
- æ’é˜Ÿæ£€æµ‹: queue_detector.py
- äººç¾¤å¯†åº¦: crowd_density_detector.py
- äººæµæ–¹å‘: flow_direction_analyzer.py

# è·¯å¾„çŠ¶æ€åˆ¤æ–­
- é—¨ç‰Œæ¨ç†: doorplate_inference.py
- å±é™©ç¯å¢ƒ: hazard_detector.py
```

#### è¾“å‡ºæ•°æ®
```json
{
  "event": "path_analysis",
  "level": "medium",
  "data": {
    "crowd_density": "crowded",
    "flow_direction": "counter",
    "queue_detected": true,
    "hazards": [
      {"type": "water", "severity": "high"}
    ]
  },
  "timestamp": "..."
}
```

---

### 3. æ’­æŠ¥ç­–ç•¥å±‚ (Speech Layer)

**èŒè´£**: æ™ºèƒ½è¯­éŸ³æ’­æŠ¥ã€é£æ ¼åˆ‡æ¢

#### æ ¸å¿ƒæ¨¡å—
```python
# TTSç®¡ç†
- TTSç®¡ç†å™¨: tts_manager.py
- è¯­éŸ³é£æ ¼åˆ‡æ¢: TTSStyle

# å†…å®¹ç”Ÿæˆ
- è¯­éŸ³å†…å®¹æ¨¡æ¿
- æƒ…ç»ªåŒ–æ’­æŠ¥
```

#### è¾“å‡ºæ•°æ®
```json
{
  "event": "speech_broadcast",
  "level": "high",
  "data": {
    "text": "å‰æ–¹äººç¾¤å¯†é›†ï¼Œè¯·æ³¨æ„å®‰å…¨",
    "style": "urgent",
    "voice": "zh-CN-XiaoxiaoNeural",
    "rate": 1.5,
    "pitch": 1.3
  },
  "timestamp": "..."
}
```

---

### 4. ç”¨æˆ·äº¤äº’å±‚ (User Layer)

**èŒè´£**: ç”¨æˆ·äº¤äº’ã€åé¦ˆå¤„ç†

#### æ ¸å¿ƒæ¨¡å—
```python
# ç”¨æˆ·ç®¡ç†
- ç”¨æˆ·ç®¡ç†å™¨: user_manager.py
- çŸ­ä¿¡éªŒè¯: éªŒè¯ç æœåŠ¡

# è®°å¿†ç³»ç»Ÿ
- è®°å¿†å­˜å‚¨: memory_store.py
- è®°å¿†è°ƒç”¨: memory_caller.py

# è¯­éŸ³äº¤äº’
- è¯­éŸ³è¯†åˆ«: voice_recognition.py
- è¯­éŸ³å”¤é†’: voice_wakeup.py
```

#### è¾“å‡ºæ•°æ®
```json
{
  "event": "user_interaction",
  "level": "medium",
  "data": {
    "type": "voice_command",
    "intent": "forward",
    "confidence": 0.9,
    "user_response": "..."
  },
  "timestamp": "..."
}
```

## ğŸ”„ æ•°æ®æµè½¬

### å®Œæ•´æµç¨‹ç¤ºä¾‹

```json
{
  "event": "navigation_cycle",
  "level": "high",
  "data": {
    "step_1_vision": {
      "detects": ["person", "vehicle", "signboard"],
      "count": {"persons": 3, "vehicles": 1}
    },
    "step_2_path": {
      "crowd_density": "crowded",
      "flow_direction": "counter",
      "queue_detected": false
    },
    "step_3_decision": {
      "action": "slow_down_and_warn",
      "style": "urgent"
    },
    "step_4_speech": {
      "text": "å‰æ–¹äººç¾¤å¯†é›†ä¸”å­˜åœ¨é€†å‘äººæµï¼Œè¯·å‡é€Ÿå¹¶é å³è¡Œèµ°"
    }
  },
  "timestamp": "..."
}
```

## ğŸ“Š æ¨¡å—æ˜ å°„è¡¨

| æ¶æ„å±‚ | æ¨¡å—æ–‡ä»¶ | åŠŸèƒ½ |
|--------|---------|------|
| **è§†è§‰æ„ŸçŸ¥å±‚** | `ocr_advanced_reader.py` | OCRæ–‡æ¡£è¯†åˆ« |
|  | `product_info_checker.py` | å•†å“æˆåˆ†è¯†åˆ« |
|  | `doorplate_reader.py` | é—¨ç‰Œè¯†åˆ« |
|  | `signboard_detector.py` | æ ‡è¯†ç‰Œè¯†åˆ« |
|  | `facility_detector.py` | å…¬å…±è®¾æ–½è¯†åˆ« |
|  | `hazard_detector.py` | å±é™©ç¯å¢ƒè¯†åˆ« |
|  | `local_map_generator.py` | å±€éƒ¨åœ°å›¾ç”Ÿæˆ |
| **è·¯å¾„åˆ¤æ–­å±‚** | `queue_detector.py` | æ’é˜Ÿæ£€æµ‹ |
|  | `crowd_density_detector.py` | äººç¾¤å¯†åº¦ |
|  | `flow_direction_analyzer.py` | äººæµæ–¹å‘ |
|  | `doorplate_inference.py` | é—¨ç‰Œæ¨ç† |
| **æ’­æŠ¥ç­–ç•¥å±‚** | `tts_manager.py` | TTSç®¡ç† |
| **ç”¨æˆ·äº¤äº’å±‚** | `user_manager.py` | ç”¨æˆ·ç®¡ç† |
|  | `memory_store.py` | è®°å¿†å­˜å‚¨ |
|  | `memory_caller.py` | è®°å¿†è°ƒç”¨ |
|  | `voice_recognition.py` | è¯­éŸ³è¯†åˆ« |
|  | `voice_wakeup.py` | è¯­éŸ³å”¤é†’ |
|  | `mcp_controller.py` | è®¾å¤‡æ§åˆ¶ |

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. æ•°æ®é©±åŠ¨
- æ‰€æœ‰è¾“å‡ºç»Ÿä¸€ä¸ºJSONæ ¼å¼
- ç»“æ„åŒ–æ•°æ®ä¾¿äºå¤„ç†å’Œæ‰©å±•
- æ ‡å‡†åŒ–æ¥å£

### 2. åˆ†å±‚è®¾è®¡
- æ¸…æ™°çš„èŒè´£åˆ’åˆ†
- æ¨¡å—é—´ä½è€¦åˆ
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### 3. æ™ºèƒ½åŒ–
- AIé©±åŠ¨çš„è§†è§‰è¯†åˆ«
- æ™ºèƒ½è·¯å¾„åˆ†æ
- æƒ…æ„ŸåŒ–è¯­éŸ³æ’­æŠ¥
- è‡ªé€‚åº”ç”¨æˆ·äº¤äº’

---

**ç‰ˆæœ¬**: v1.2  
**æ›´æ–°æ—¥æœŸ**: 2025å¹´10æœˆ27æ—¥  
**çŠ¶æ€**: âœ… æ¶æ„å®Œæ•´ï¼Œç”Ÿäº§å°±ç»ª
