# é—¨ç‰Œè¯†åˆ«ä¸æ–¹å‘æ¨ç†æ¨¡å—æ€»ç»“

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

å®ç°äº†2ä¸ªé—¨ç‰Œè¯†åˆ«ä¸æ–¹å‘æ¨ç†æ ¸å¿ƒæ¨¡å—ï¼Œæ”¯æŒé—¨ç‰Œæ–‡å­—è¯†åˆ«å’Œè¡Œè¿›æ–¹å‘æ™ºèƒ½æ¨ç†ã€‚

## âœ… å·²å®ç°æ¨¡å—

### 1. é—¨ç‰Œè§†è§‰è¯†åˆ«æ¨¡å— (`core/doorplate_reader.py`)

#### åŠŸèƒ½
è¯†åˆ«æˆ¿é—¨/æˆ¿å·/æ¥¼å±‚é—¨ç‰Œç­‰æ–‡å­—ä¿¡æ¯

#### æ ¸å¿ƒç‰¹æ€§
- âœ… OCRè¯†åˆ«æ”¯æŒæ•°å­—+æ±‰å­—ç»„åˆ
- âœ… è¾“å‡ºé—¨ç‰Œç¼–å· + åæ ‡ä½ç½®
- âœ… å›¾ç‰‡ç‰‡æ®µç”¨äºå®šä½/å¯è§†åŒ–

#### æ”¯æŒçš„é—¨ç‰Œç±»å‹
- **ROOM** (æˆ¿é—´): 501å®¤, R501
- **FLOOR** (æ¥¼å±‚): 5å±‚, 5F, 5æ¥¼
- **BUILDING** (æ¥¼æ ‹): 8æ ‹, 8å·æ¥¼, 8å¹¢
- **AREA** (åŒºåŸŸ): ä¸œåŒº8æ ‹, è¥¿åŒº8æ ‹

#### è¯†åˆ«æ¨¡å¼
```python
- æˆ¿é—´å·: 501å®¤, ç¬¬501å·, R501
- æ¥¼å±‚: 5å±‚, 5F, 5æ¥¼
- æ¥¼æ ‹: 8æ ‹, 8å·æ¥¼
- åŒºåŸŸ: ä¸œåŒº8æ ‹, å—åŒº8æ ‹
```

#### è¾“å‡ºæ•°æ®ç»“æ„
```python
DoorplateInfo:
  - text: str                   # é—¨ç‰Œæ–‡å­—
  - type: DoorplateType        # é—¨ç‰Œç±»å‹
  - bbox: Tuple                # è¾¹ç•Œæ¡†
  - confidence: float          # ç½®ä¿¡åº¦
  - direction: Optional[str]   # æ–¹å‘
  - number: Optional[int]     # æ•°å­—ç¼–å·
```

#### æµ‹è¯•ç»“æœ
```
âœ… æ£€æµ‹åˆ° 3 ä¸ªé—¨ç‰Œ
âœ… é—¨ç‰Œç±»å‹: room, floor, area
âœ… ç¼–å·æå–: 501, 5, 8
âœ… æ–¹å‘è¯†åˆ«: east
```

---

### 2. é—¨ç‰Œæ¨ç†å¼•æ“æ¨¡å— (`core/doorplate_inference.py`)

#### åŠŸèƒ½
æ ¹æ®è¿ç»­é—¨ç‰Œä¿¡æ¯åˆ¤æ–­ç”¨æˆ·è¡Œè¿›æ–¹å‘æ˜¯å¦æ­£ç¡®

#### æ ¸å¿ƒç‰¹æ€§
- âœ… é—¨ç‰Œå·å¢åŠ  â†’ å‘å‰æ¨è¿›
- âœ… é—¨ç‰Œå·å‡å°‘ â†’ æ–¹å‘é”™è¯¯è­¦å‘Š
- âœ… æ”¯æŒé”™è¯¯æ¨æ–­è­¦å‘Š

#### è¿åŠ¨çŠ¶æ€
- **FORWARD** (å‘å‰): é—¨ç‰Œå·å¢åŠ 
- **BACKWARD** (å‘å): é—¨ç‰Œå·å‡å°‘ï¼ˆé”™è¯¯æ–¹å‘ï¼‰
- **CORRECT** (æ­£ç¡®): æ–¹å‘æ­£ç¡®
- **WRONG** (é”™è¯¯): æ–¹å‘é”™è¯¯
- **UNKNOWN** (æœªçŸ¥): æ— æ³•ç¡®å®š

#### æ¨ç†é€»è¾‘
```python
if current_number > prev_number:
    â†’ å‘å‰æ¨è¿›ä¸­
    â†’ æœŸæœ›ä¸‹ä¸€ä¸ªé—¨ç‰Œå· = current + step
    
if current_number < prev_number:
    â†’ æ–¹å‘é”™è¯¯ï¼šé—¨ç‰Œå˜å°ï¼Œå¯èƒ½èµ°é”™æ–¹å‘
    â†’ è­¦å‘Šç”¨æˆ·
    
if current_number == prev_number:
    â†’ é—¨ç‰Œå·æœªå˜åŒ–ï¼Œè¯·ç¡®è®¤è¡Œè¿›æ–¹å‘
```

#### è¾“å‡ºæ•°æ®ç»“æ„
```python
DirectionInference:
  - status: MovementStatus     # è¿åŠ¨çŠ¶æ€
  - message: str              # æç¤ºæ¶ˆæ¯
  - confidence: float         # ç½®ä¿¡åº¦
  - expected_next: Optional[int]  # æœŸæœ›ä¸‹ä¸€ä¸ªé—¨ç‰Œå·
```

#### æµ‹è¯•ç»“æœ
```
âœ… å‘å‰èµ°æµ‹è¯•: forward, æœŸæœ›ä¸‹ä¸€ä¸ªé—¨ç‰Œ=511
âœ… èµ°é”™æ–¹å‘æµ‹è¯•: backward, ç½®ä¿¡åº¦=0.90
âœ… è¿åŠ¨åºåˆ—è·Ÿè¸ª: [509, 501]
```

---

## ğŸ”— æ¨¡å—é›†æˆ

### ç»¼åˆä½¿ç”¨ç¤ºä¾‹

```python
from core.doorplate_reader import DoorplateReader
from core.doorplate_inference import DoorplateInferenceEngine

# åˆå§‹åŒ–
reader = DoorplateReader()
engine = DoorplateInferenceEngine()

# 1. è¯†åˆ«é—¨ç‰Œ
image = cv2.imread('doorplate.jpg')
doorplates = reader.detect_doorplates(image)

for doorplate in doorplates:
    # 2. æ¨ç†æ–¹å‘
    inference = engine.infer_direction(doorplate)
    
    # 3. æ ¹æ®æ¨ç†ç»“æœæ’­æŠ¥
    if inference.status == MovementStatus.FORWARD:
        tts.speak(f"âœ… {inference.message}")
    elif inference.status == MovementStatus.BACKWARD:
        tts.speak(f"âš ï¸ {inference.message}", tone="urgent")
    
    # 4. æ˜¾ç¤ºæœŸæœ›çš„ä¸‹ä¸€ä¸ªé—¨ç‰Œ
    if inference.expected_next:
        tts.speak(f"æœŸæœ›çš„ä¸‹ä¸€ä¸ªé—¨ç‰Œ: {inference.expected_next}")
```

### è¯­éŸ³æ’­æŠ¥é›†æˆ

```python
# å®æ—¶é—¨ç‰Œè¯†åˆ«ä¸æ¨ç†
def doorplate_navigation(frame):
    # è¯†åˆ«é—¨ç‰Œ
    doorplates = reader.detect_doorplates(frame)
    
    for doorplate in doorplates:
        # æ’­æŠ¥é—¨ç‰Œ
        tts.speak(f"æ£€æµ‹åˆ°é—¨ç‰Œ: {doorplate.text}")
        
        # æ¨ç†æ–¹å‘
        inference = engine.infer_direction(doorplate)
        
        # æ ¹æ®çŠ¶æ€æ’­æŠ¥
        if inference.status == MovementStatus.FORWARD:
            tts.speak("âœ… æ–¹å‘æ­£ç¡®ï¼Œç»§ç»­å‰è¿›")
        elif inference.status == MovementStatus.BACKWARD:
            tts.speak("âš ï¸ è­¦å‘Šï¼šæ–¹å‘å¯èƒ½é”™è¯¯ï¼Œè¯·ç¡®è®¤", tone="urgent")
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æ­£å¸¸è¡Œè¿›
```
ç”¨æˆ·å‘å‰èµ°
â†’ æ£€æµ‹åˆ°é—¨ç‰Œ501
â†’ æ£€æµ‹åˆ°é—¨ç‰Œ509
â†’ æ¨ç†ï¼šå‘å‰æ¨è¿›ä¸­ï¼ˆ501 â†’ 509ï¼‰
â†’ æ’­æŠ¥ï¼š"æ–¹å‘æ­£ç¡®ï¼Œç»§ç»­å‰è¿›"
â†’ æ˜¾ç¤ºæœŸæœ›ä¸‹ä¸€ä¸ªé—¨ç‰Œï¼š511
```

### åœºæ™¯2: èµ°é”™æ–¹å‘
```
ç”¨æˆ·å‘åèµ°
â†’ æ£€æµ‹åˆ°é—¨ç‰Œ509
â†’ æ£€æµ‹åˆ°é—¨ç‰Œ501
â†’ æ¨ç†ï¼šæ–¹å‘é”™è¯¯ï¼šé—¨ç‰Œå˜å°
â†’ æ’­æŠ¥ï¼š"âš ï¸ è­¦å‘Šï¼šæ–¹å‘å¯èƒ½é”™è¯¯ï¼Œè¯·ç¡®è®¤"
```

### åœºæ™¯3: æ¥¼å±‚å¯¼èˆª
```
ç”¨æˆ·åœ¨ç”µæ¢¯å†…
â†’ æ£€æµ‹åˆ°é—¨ç‰Œï¼š5å±‚
â†’ æ›´æ–°å½“å‰æ¥¼å±‚ä¿¡æ¯
â†’ ååŠ©ç”¨æˆ·ç¡®è®¤æ¥¼å±‚
```

---

## ğŸ“ˆ æŠ€æœ¯ç‰¹ç‚¹

### 1. æ™ºèƒ½è¯†åˆ«
- **å¤šç§ç±»å‹**: æˆ¿é—´å·/æ¥¼å±‚/æ¥¼æ ‹/åŒºåŸŸ
- **æ–¹å‘è¯†åˆ«**: ä¸œ/è¥¿/å—/åŒ—
- **æ•°å­—æå–**: è‡ªåŠ¨æå–ç¼–å·
- **åæ ‡å®šä½**: è¾¹ç•Œæ¡†å®šä½

### 2. æ™ºèƒ½æ¨ç†
- **æ–¹å‘åˆ¤æ–­**: 5ç§è¿åŠ¨çŠ¶æ€
- **é”™è¯¯æ£€æµ‹**: é—¨ç‰Œå·å˜å°è­¦å‘Š
- **æœŸæœ›é¢„æµ‹**: é¢„æµ‹ä¸‹ä¸€ä¸ªé—¨ç‰Œå·
- **ç½®ä¿¡åº¦è¯„ä¼°**: æ¨ç†ç½®ä¿¡åº¦

### 3. å®æ—¶è·Ÿè¸ª
- **å†å²è®°å½•**: ä¿å­˜é—¨ç‰Œåºåˆ—
- **è¿åŠ¨åºåˆ—**: è·Ÿè¸ªè¡Œè¿›è·¯å¾„
- **çŠ¶æ€æ¨ç†**: å®æ—¶æ–¹å‘åˆ†æ
- **å¿«é€Ÿé‡ç½®**: æ”¯æŒé‡æ–°å¼€å§‹

---

## ğŸŠ æ€»ç»“

æˆåŠŸå®ç°äº†2ä¸ªé—¨ç‰Œè¯†åˆ«æ¨¡å—ï¼š

1. âœ… **é—¨ç‰Œè¯†åˆ«** - è§†è§‰è¯†åˆ«ä¸è§£æ
2. âœ… **æ–¹å‘æ¨ç†** - æ™ºèƒ½æ–¹å‘åˆ¤æ–­

æ‰€æœ‰æ¨¡å—å·²é€šè¿‡æµ‹è¯•ï¼Œå¯ä»¥ç«‹å³æŠ•å…¥ä½¿ç”¨ï¼

---

**å®ç°æ—¥æœŸ**: 2025å¹´10æœˆ27æ—¥  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… æµ‹è¯•é€šè¿‡
